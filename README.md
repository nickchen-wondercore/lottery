# 尾牙抽獎系統

基於 Matter.js 物理引擎的互動式抽獎應用程式，模擬真實的球體容器抽獎機制。

## 專案架構

```
v2/
├── index.html      # 頁面入口，載入所有模組
├── style.css       # UI 樣式（深色主題）
├── physics.js      # Matter.js 物理引擎核心
├── renderer.js     # Canvas 2D 繪製模組
├── app.js          # 應用程式控制器（狀態機、UI 綁定）
└── names.json      # 抽獎名單（JSON 陣列）
```

## 模組說明

### `physics.js` — 物理引擎

IIFE 模組，封裝所有 Matter.js 物理邏輯。

| 功能區塊 | 說明 |
|---------|------|
| **圓形容器** | 由 90 段弧形牆體組成，頂部留出口管缺口，左上方留入球缺口 |
| **出口管** | 垂直管道，底端與圓弧切齊，頂端設有閘門 |
| **閘門機制** | `openExitGate()` / `closeExitGate()` 控制出球閘門開關 |
| **球體生成** | `createBalls()` 每 80ms 在容器內生成一顆球，避免重疊 |
| **封蓋** | `sealContainer()` 封閉入球缺口與頂部間隙，僅留出口管開口 |
| **亂流** | `startTurbulence()` 關閉重力，施加旋轉力、噪音擾動、隨機爆發力 |
| **彈射出球** | `ejectOneBall(callback)` 隨機選球，施加浮力引導通過出口管 |

**碰撞分類：**
- `CAT_BALL (0x0001)` — 一般球體
- `CAT_WALL (0x0002)` — 牆壁
- `CAT_EXITING (0x0004)` — 正在出球的球體（僅與出口管牆壁碰撞）

**球體出球階段：** `rising` → `entering` → `upChannel` → `hasExited`

### `renderer.js` — Canvas 繪製

IIFE 模組，負責所有視覺渲染。

| 繪製層 | 說明 |
|-------|------|
| 出口管 | 半透明管道 + 側壁線條 + 閘門金色橫槓 |
| 斜坡/閘門 | 金屬質感斜坡面（目前未啟用） |
| 容器填充 | 徑向漸層玻璃球體背景 |
| 球體 | 金色球體 + 高光 + 名字文字 |
| 容器邊框 | 玻璃邊緣環 + 金屬外框 + 缺口處理 |

**繪製順序：** 出口管 → 斜坡 → 容器填充 → 球體 → 容器邊框

### `app.js` — 應用控制器

IIFE 模組，管理狀態機與 UI 互動。

**狀態機：**

```
IDLE → LOADING → READY → DRAWING → READY / COMPLETE
                           ↑            │
                           └────────────┘
```

| 狀態 | 說明 |
|------|------|
| `IDLE` | 初始狀態，可按「入籤筒」 |
| `LOADING` | 球體生成中，等待穩定 |
| `READY` | 就緒，可按「抽籤」 |
| `DRAWING` | 亂流混合 + 週期性開閘出球 |
| `COMPLETE` | 所有球已抽完 |

**抽獎流程：**

1. 啟動亂流混合球體
2. 等待 2 秒混合
3. 開閘門 → 彈射 1 球 → 球出管 → 關閘門 → 顯示中獎名字
4. 等待 N 秒（依「間隔」設定）
5. 重複步驟 3-4 直到抽完指定數量
6. 停止亂流 → 關閘門 → 回到 READY

### `names.json` — 抽獎名單

JSON 陣列格式，每個元素為一個字串名字。修改此檔案即可自訂抽獎名單。

```json
["Alice", "Bob", "Charlie", ...]
```

## UI 控制項

| 控制項 | 說明 |
|-------|------|
| **入籤筒** | 將名單中的球放入容器 |
| **數量** | 本次抽籤要抽出的球數（1 ~ 剩餘球數） |
| **抽籤** | 開始抽獎 |
| **間隔** | 每顆球彈出的間隔秒數（1-10 秒） |
| **氣流** | 亂流旋轉強度（slider 1-10，值越大越激烈） |
| **重置** | 清除結果，重新開始 |

## 技術棧

- **Matter.js 0.20.0** — 2D 物理引擎（CDN 載入）
- **Canvas 2D API** — 自訂繪製（非 Matter.js 內建 renderer）
- **純前端** — 無框架、無建置工具，靜態檔案直接運行

## 使用方式

1. 編輯 `names.json` 填入抽獎名單
2. 用任意靜態伺服器啟動（如 `npx serve .` 或 `python -m http.server 8080`）
3. 瀏覽器開啟 `http://localhost:8080/`
